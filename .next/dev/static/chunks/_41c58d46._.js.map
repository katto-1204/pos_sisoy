{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Administrator/Downloads/pos_sisoy/lib/api.ts"],"sourcesContent":["// Utility to get the correct API base URL\r\nexport function getApiBase(): string {\r\n  if (typeof window === 'undefined') {\r\n    return process.env.NEXT_PUBLIC_API_URL || 'http://localhost:3000/api'\r\n  }\r\n  \r\n  // Try multiple sources in order of preference\r\n  return (\r\n    process.env.NEXT_PUBLIC_API_URL || \r\n    (window as any).API_BASE ||\r\n    `http://${window.location.hostname}:${window.location.port}/api` ||\r\n    'http://localhost:3000/api'\r\n  )\r\n}\r\n"],"names":[],"mappings":"AAAA,0CAA0C;;;;;AAQtC;AAPG,SAAS;IACd;;IAIA,8CAA8C;IAC9C,OACE,iEACA,AAAC,OAAe,QAAQ,IACxB,CAAC,OAAO,EAAE,OAAO,QAAQ,CAAC,QAAQ,CAAC,CAAC,EAAE,OAAO,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,IAChE;AAEJ"}},
    {"offset": {"line": 23, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Administrator/Downloads/pos_sisoy/app/%28dashboard%29/dashboard/page.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport { useState, useEffect } from \"react\"\r\nimport Link from \"next/link\"\r\nimport { storage, type Booking } from \"@/lib/storage\"\r\nimport { getApiBase } from \"@/lib/api\"\r\n\r\nexport default function DashboardPage() {\r\n  const [bookings, setBookings] = useState<Booking[]>([])\r\n  const [stats, setStats] = useState({\r\n    todayBookings: 0,\r\n    availableRooms: 0,\r\n    occupiedRooms: 0,\r\n    totalSales: 0,\r\n  })\r\n\r\n  useEffect(() => {\r\n    const syncBookingsFromServer = async () => {\r\n      try {\r\n        const apiBase = getApiBase()\r\n        \r\n        // Fetch fresh bookings from server\r\n        const res = await fetch(`${apiBase}/bookings?action=list`, {\r\n          method: 'GET',\r\n          headers: { 'Content-Type': 'application/json' },\r\n        })\r\n        \r\n        if (res.ok) {\r\n          const serverBookings = await res.json()\r\n          \r\n          // Convert server format to client Booking format\r\n          const convertedBookings: Booking[] = serverBookings.map((b: any) => ({\r\n            id: String(b.id),\r\n            clientId: String(b.customer_id),\r\n            accommodationId: String(b.accommodation_id),\r\n            dateFrom: b.check_in,\r\n            dateTo: b.check_out,\r\n            status: b.status.toLowerCase() === 'confirmed' ? 'confirmed' : 'pending',\r\n            totalAmount: parseFloat(b.total_price),\r\n            createdAt: b.created_at,\r\n            paymentStatus: 'paid',\r\n            accommodation_name: b.accommodation_name, // Store room name for display\r\n          }))\r\n          \r\n          // Update localStorage with fresh data\r\n          localStorage.setItem('pos_bookings', JSON.stringify(convertedBookings))\r\n          setBookings(convertedBookings)\r\n          calculateStats(convertedBookings)\r\n        } else {\r\n          // Fallback to localStorage if server unavailable\r\n          const allBookings = storage.getBookings()\r\n          setBookings(allBookings)\r\n          calculateStats(allBookings)\r\n        }\r\n      } catch (err) {\r\n        console.error('Error fetching bookings:', err)\r\n        // Fallback to localStorage\r\n        const allBookings = storage.getBookings()\r\n        setBookings(allBookings)\r\n        calculateStats(allBookings)\r\n      }\r\n    }\r\n\r\n    const calculateStats = (allBookings: any[]) => {\r\n      const today = new Date().toISOString().split(\"T\")[0]\r\n      \r\n      // \"Bookings Today\" = bookings CREATED today (createdAt date)\r\n      const todayBookings = allBookings.filter((b) => {\r\n        const createdDate = new Date(b.createdAt).toISOString().split(\"T\")[0]\r\n        return createdDate === today\r\n      })\r\n\r\n      const accommodations = storage.getAccommodations()\r\n      \r\n      // \"Occupied Rooms\" = rooms with active bookings today (check_in <= today < check_out)\r\n      const occupiedToday = new Set(\r\n        allBookings\r\n          .filter((b) => {\r\n            const from = new Date(b.dateFrom).toISOString().split(\"T\")[0]\r\n            const to = new Date(b.dateTo).toISOString().split(\"T\")[0]\r\n            return from <= today && today < to && b.status !== \"cancelled\"\r\n          })\r\n          .map((b) => b.accommodationId),\r\n      ).size\r\n\r\n      // \"Total Sales\" = sum of all paid bookings\r\n      const totalSales = allBookings.filter((b) => b.paymentStatus === \"paid\").reduce((sum, b) => sum + b.totalAmount, 0)\r\n\r\n      setStats({\r\n        todayBookings: todayBookings.length,\r\n        availableRooms: accommodations.length - occupiedToday,\r\n        occupiedRooms: occupiedToday,\r\n        totalSales,\r\n      })\r\n    }\r\n\r\n    syncBookingsFromServer()\r\n  }, [])\r\n\r\n  const StatCard = ({ title, value }: { title: string; value: number | string }) => (\r\n    <div className=\"bg-white border border-(--gray-light) rounded p-6 shadow-sm\">\r\n      <p className=\"text-sm text-(--gray-dark) mb-2\">{title}</p>\r\n      <p className=\"text-3xl font-bold text-(--primary-blue)\">{value}</p>\r\n    </div>\r\n  )\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <h1 className=\"text-3xl font-bold text-(--primary-blue)\">Dashboard</h1>\r\n\r\n      {/* Stats Grid */}\r\n      <div className=\"grid grid-cols-4 gap-4\">\r\n        <StatCard title=\"Bookings Today\" value={stats.todayBookings} />\r\n        <StatCard title=\"Available Rooms\" value={stats.availableRooms} />\r\n        <StatCard title=\"Occupied Rooms\" value={stats.occupiedRooms} />\r\n        <StatCard title=\"Total Sales\" value={`â‚±${stats.totalSales.toLocaleString()}`} />\r\n      </div>\r\n\r\n      {/* Main Section */}\r\n      <div className=\"grid grid-cols-3 gap-6\">\r\n        {/* Bookings Today Table */}\r\n        <div className=\"col-span-2 bg-white border border-(--gray-light) rounded p-6\">\r\n          <h2 className=\"text-lg font-bold text-(--gray-dark) mb-4\">Today's Bookings</h2>\r\n          <div className=\"overflow-x-auto\">\r\n            <table className=\"w-full text-sm\">\r\n              <thead>\r\n                <tr className=\"border-b border-(--gray-light)\">\r\n                  <th className=\"text-left py-2 px-2 font-bold text-(--gray-dark)\">Time</th>\r\n                  <th className=\"text-left py-2 px-2 font-bold text-(--gray-dark)\">Client</th>\r\n                  <th className=\"text-left py-2 px-2 font-bold text-(--gray-dark)\">Room</th>\r\n                  <th className=\"text-left py-2 px-2 font-bold text-(--gray-dark)\">Status</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody>\r\n                {bookings.slice(0, 5).map((b) => (\r\n                  <tr key={b.id} className=\"border-b border-(--gray-light)\">\r\n                    <td className=\"py-3 px-2\">{new Date(b.createdAt).toLocaleTimeString()}</td>\r\n                    <td className=\"py-3 px-2\">\r\n                      {storage.getClients().find((c) => c.id === b.clientId)?.firstName || \"N/A\"}\r\n                    </td>\r\n                    <td className=\"py-3 px-2\">\r\n                      {(b as any).accommodation_name || storage.getAccommodations().find((a) => a.id === b.accommodationId)?.name || \"N/A\"}\r\n                    </td>\r\n                    <td className=\"py-3 px-2\">\r\n                      <span\r\n                        className={`px-2 py-1 rounded text-xs font-bold ${\r\n                          b.status === \"confirmed\"\r\n                            ? \"bg-green-100 text-green\"\r\n                            : b.status === \"pending\"\r\n                              ? \"bg-yellow-100 text-yellow-800\"\r\n                              : \"bg-gray-100 text-gray-800\"\r\n                        }`}\r\n                      >\r\n                        {b.status}\r\n                      </span>\r\n                    </td>\r\n                  </tr>\r\n                ))}\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Actions Panel */}\r\n        <div className=\"bg-white border border-(--gray-light) rounded p-6 h-fit space-y-3\">\r\n          <h2 className=\"text-lg font-bold text-(--gray-dark) mb-4\">Quick Actions</h2>\r\n          <Link\r\n            href=\"/booking/new\"\r\n            className=\"block w-full py-3 bg-(--yellow) text-(--gray-dark) font-bold rounded text-center hover:bg-yellow-400 transition-colors\"\r\n          >\r\n            New Booking\r\n          </Link>\r\n          <Link\r\n            href=\"/accommodations\"\r\n            className=\"block w-full py-2 bg-(--primary-blue) text-white font-bold rounded text-center hover:bg-blue-900 transition-colors\"\r\n          >\r\n            Accommodations\r\n          </Link>\r\n          <Link\r\n            href=\"/reports\"\r\n            className=\"block w-full py-2 bg-(--primary-blue) text-white font-bold rounded text-center hover:bg-blue-900 transition-colors\"\r\n          >\r\n            Reports\r\n          </Link>\r\n          <Link\r\n            href=\"/bookings\"\r\n            className=\"block w-full py-2 bg-(--primary-blue) text-white font-bold rounded text-center hover:bg-blue-900 transition-colors\"\r\n          >\r\n            All Bookings\r\n          </Link>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n"],"names":[],"mappings":"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"}}]
}