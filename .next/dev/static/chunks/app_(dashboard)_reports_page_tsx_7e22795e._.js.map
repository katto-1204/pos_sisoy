{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Administrator/Downloads/pos_sisoy/app/%28dashboard%29/reports/page.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport { useState, useEffect } from \"react\"\r\nimport { storage, type Booking } from \"@/lib/storage\"\r\n\r\nexport default function ReportsPage() {\r\n  const [bookings, setBookings] = useState<Booking[]>([])\r\n  const [dateRange, setDateRange] = useState({\r\n    start: new Date(Date.now() - 30 * 24 * 60 * 60 * 1000).toISOString().split(\"T\")[0],\r\n    end: new Date().toISOString().split(\"T\")[0],\r\n  })\r\n\r\n  useEffect(() => {\r\n    setBookings(storage.getBookings())\r\n  }, [])\r\n\r\n  const getFilteredBookings = () => {\r\n    return bookings.filter((b) => {\r\n      const date = b.dateFrom\r\n      return date >= dateRange.start && date <= dateRange.end && b.status !== \"cancelled\"\r\n    })\r\n  }\r\n\r\n  const calculateStats = () => {\r\n    const filtered = getFilteredBookings()\r\n    const totalBookings = filtered.length\r\n    const totalRevenue = filtered.filter((b) => b.paymentStatus === \"paid\").reduce((sum, b) => sum + b.totalAmount, 0)\r\n    const avgBookingValue = totalBookings > 0 ? totalRevenue / totalBookings : 0\r\n\r\n    return { totalBookings, totalRevenue, avgBookingValue }\r\n  }\r\n\r\n  const getDailySalesData = () => {\r\n    const filtered = getFilteredBookings()\r\n    const dailyData: { [key: string]: number } = {}\r\n\r\n    filtered.forEach((b) => {\r\n      if (!dailyData[b.dateFrom]) {\r\n        dailyData[b.dateFrom] = 0\r\n      }\r\n      dailyData[b.dateFrom] += b.totalAmount\r\n    })\r\n\r\n    return Object.entries(dailyData)\r\n      .sort(([dateA], [dateB]) => dateA.localeCompare(dateB))\r\n      .slice(-7)\r\n  }\r\n\r\n  const getAccommodationBreakdown = () => {\r\n    const filtered = getFilteredBookings()\r\n    const breakdown: { [key: string]: { count: number; revenue: number } } = {}\r\n\r\n    filtered.forEach((b) => {\r\n      const acc = storage.getAccommodations().find((a) => a.id === b.accommodationId)\r\n      if (acc) {\r\n        if (!breakdown[acc.name]) {\r\n          breakdown[acc.name] = { count: 0, revenue: 0 }\r\n        }\r\n        breakdown[acc.name].count++\r\n        breakdown[acc.name].revenue += b.totalAmount\r\n      }\r\n    })\r\n\r\n    return breakdown\r\n  }\r\n\r\n  const stats = calculateStats()\r\n  const dailySales = getDailySalesData()\r\n  const accommodationBreakdown = getAccommodationBreakdown()\r\n\r\n  const handleExportCSV = () => {\r\n    const filtered = getFilteredBookings()\r\n    const csv = [\r\n      [\"Date\", \"Client\", \"Accommodation\", \"Amount\", \"Status\"],\r\n      ...filtered.map((b) => {\r\n        const client = storage.getClients().find((c) => c.id === b.clientId)\r\n        const acc = storage.getAccommodations().find((a) => a.id === b.accommodationId)\r\n        return [b.dateFrom, `${client?.firstName} ${client?.lastName}`, acc?.name, b.totalAmount, b.status]\r\n      }),\r\n    ]\r\n      .map((row) => row.join(\",\"))\r\n      .join(\"\\n\")\r\n\r\n    const blob = new Blob([csv], { type: \"text/csv\" })\r\n    const url = window.URL.createObjectURL(blob)\r\n    const a = document.createElement(\"a\")\r\n    a.href = url\r\n    a.download = `report-${dateRange.start}.csv`\r\n    a.click()\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <h1 className=\"text-3xl font-bold text-(--primary-blue)\">Reports</h1>\r\n\r\n      {/* Date Range Filter */}\r\n      <div className=\"bg-white border border-(--gray-light) rounded p-4 flex gap-4 items-end\">\r\n        <div>\r\n          <label className=\"block text-sm font-bold text-(--gray-dark) mb-1\">From</label>\r\n          <input\r\n            type=\"date\"\r\n            value={dateRange.start}\r\n            onChange={(e) => setDateRange({ ...dateRange, start: e.target.value })}\r\n            className=\"px-3 py-2 border border-(--gray-light) rounded\"\r\n          />\r\n        </div>\r\n        <div>\r\n          <label className=\"block text-sm font-bold text-(--gray-dark) mb-1\">To</label>\r\n          <input\r\n            type=\"date\"\r\n            value={dateRange.end}\r\n            onChange={(e) => setDateRange({ ...dateRange, end: e.target.value })}\r\n            className=\"px-3 py-2 border border-(--gray-light) rounded\"\r\n          />\r\n        </div>\r\n        <button\r\n          onClick={handleExportCSV}\r\n          className=\"px-4 py-2 bg-(--yellow) text-(--gray-dark) rounded font-bold hover:bg-yellow-400\"\r\n        >\r\n          Export CSV\r\n        </button>\r\n      </div>\r\n\r\n      {/* Key Metrics */}\r\n      <div className=\"grid grid-cols-3 gap-4\">\r\n        <div className=\"bg-white border border-(--gray-light) rounded p-6\">\r\n          <p className=\"text-sm text-(--gray-dark) mb-1\">Total Bookings</p>\r\n          <p className=\"text-3xl font-bold text-(--primary-blue)\">{stats.totalBookings}</p>\r\n        </div>\r\n        <div className=\"bg-white border border-(--gray-light) rounded p-6\">\r\n          <p className=\"text-sm text-(--gray-dark) mb-1\">Total Revenue</p>\r\n          <p className=\"text-3xl font-bold text-(--primary-blue)\">₱{stats.totalRevenue.toLocaleString()}</p>\r\n        </div>\r\n        <div className=\"bg-white border border-(--gray-light) rounded p-6\">\r\n          <p className=\"text-sm text-(--gray-dark) mb-1\">Avg. Booking Value</p>\r\n          <p className=\"text-3xl font-bold text-(--primary-blue)\">\r\n            ₱{Math.round(stats.avgBookingValue).toLocaleString()}\r\n          </p>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Daily Sales */}\r\n      <div className=\"bg-white border border-(--gray-light) rounded p-6\">\r\n        <h2 className=\"text-lg font-bold text-(--gray-dark) mb-4\">Last 7 Days Sales</h2>\r\n        <div className=\"space-y-2\">\r\n          {dailySales.map(([date, amount]) => (\r\n            <div key={date} className=\"flex items-center gap-4\">\r\n              <span className=\"w-24 text-sm font-bold\">{date}</span>\r\n              <div className=\"flex-1 bg-(--gray-bg) rounded h-8 relative overflow-hidden\">\r\n                <div\r\n                  className=\"bg-(--yellow) h-full transition-all\"\r\n                  style={{\r\n                    width: `${Math.min(100, (amount / Math.max(...dailySales.map((d) => d[1]))) * 100)}%`,\r\n                  }}\r\n                />\r\n              </div>\r\n              <span className=\"w-32 text-right font-bold\">₱{amount.toLocaleString()}</span>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Accommodation Breakdown */}\r\n      <div className=\"bg-white border border-(--gray-light) rounded p-6\">\r\n        <h2 className=\"text-lg font-bold text-(--gray-dark) mb-4\">Accommodation Performance</h2>\r\n        <div className=\"overflow-x-auto\">\r\n          <table className=\"w-full\">\r\n            <thead className=\"bg-(--gray-bg) border-b border-(--gray-light)\">\r\n              <tr>\r\n                <th className=\"text-left py-2 px-4 font-bold\">Accommodation</th>\r\n                <th className=\"text-left py-2 px-4 font-bold\">Bookings</th>\r\n                <th className=\"text-left py-2 px-4 font-bold\">Revenue</th>\r\n                <th className=\"text-left py-2 px-4 font-bold\">Avg/Booking</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              {Object.entries(accommodationBreakdown).map(([name, data]) => (\r\n                <tr key={name} className=\"border-b border-(--gray-light)\">\r\n                  <td className=\"py-3 px-4\">{name}</td>\r\n                  <td className=\"py-3 px-4 font-bold\">{data.count}</td>\r\n                  <td className=\"py-3 px-4 font-bold\">₱{data.revenue.toLocaleString()}</td>\r\n                  <td className=\"py-3 px-4\">₱{Math.round(data.revenue / data.count).toLocaleString()}</td>\r\n                </tr>\r\n              ))}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n"],"names":[],"mappings":"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"}}]
}