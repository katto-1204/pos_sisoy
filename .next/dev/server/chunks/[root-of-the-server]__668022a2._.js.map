{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Administrator/Downloads/pos_sisoy/app/api/bookings/route.js"],"sourcesContent":["import fs from 'fs';\r\nimport path from 'path';\r\n\r\nconst getFilePath = (filename) => path.join(process.cwd(), 'data', filename);\r\nconst ensureDir = () => {\r\n  const dir = path.join(process.cwd(), 'data');\r\n  if (!fs.existsSync(dir)) {\r\n    fs.mkdirSync(dir, { recursive: true });\r\n  }\r\n};\r\n\r\nexport async function GET(request) {\r\n  try {\r\n    ensureDir();\r\n    const searchParams = new URL(request.url).searchParams;\r\n    const action = searchParams.get('action');\r\n\r\n    if (action === 'list') {\r\n      const bookingsPath = getFilePath('bookings.json');\r\n      \r\n      if (!fs.existsSync(bookingsPath)) {\r\n        return Response.json({ data: [] });\r\n      }\r\n\r\n      const bookings = JSON.parse(fs.readFileSync(bookingsPath, 'utf-8') || '[]');\r\n      return Response.json({ data: bookings });\r\n    }\r\n\r\n    return Response.json({ error: 'Invalid action' }, { status: 400 });\r\n  } catch (error) {\r\n    console.error('Booking fetch error:', error);\r\n    return Response.json({ error: 'Failed to fetch bookings' }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function POST(request) {\r\n  try {\r\n    ensureDir();\r\n    const searchParams = new URL(request.url).searchParams;\r\n    const action = searchParams.get('action');\r\n    \r\n    if (action === 'create') {\r\n      const body = await request.json();\r\n      \r\n      // Validate required fields\r\n      const required = ['customer_id', 'accommodation_id', 'check_in', 'check_out', 'guests', 'total_price'];\r\n      for (const field of required) {\r\n        if (!body[field]) {\r\n          return Response.json({ error: `${field} is required` }, { status: 400 });\r\n        }\r\n      }\r\n\r\n      const bookingsPath = getFilePath('bookings.json');\r\n      \r\n      let bookings = [];\r\n      if (fs.existsSync(bookingsPath)) {\r\n        const content = fs.readFileSync(bookingsPath, 'utf-8');\r\n        bookings = JSON.parse(content || '[]');\r\n      }\r\n\r\n      // Generate booking ID and number\r\n      const bookingNumber = `BK-${new Date().toISOString().slice(0, 10).replace(/-/g, '')}-${Math.random().toString(36).substring(2, 6).toUpperCase()}`;\r\n      const bookingId = bookings.length > 0 ? Math.max(...bookings.map((b) => b.id || 0)) + 1 : 1;\r\n\r\n      const newBooking = {\r\n        id: bookingId,\r\n        booking_number: bookingNumber,\r\n        customer_id: parseInt(body.customer_id),\r\n        accommodation_id: parseInt(body.accommodation_id),\r\n        check_in: body.check_in,\r\n        check_out: body.check_out,\r\n        guests: parseInt(body.guests),\r\n        total_price: parseFloat(body.total_price),\r\n        status: 'confirmed',\r\n        created_at: new Date().toISOString(),\r\n        notes: body.notes || '',\r\n      };\r\n\r\n      bookings.push(newBooking);\r\n      \r\n      // Save bookings\r\n      fs.writeFileSync(bookingsPath, JSON.stringify(bookings, null, 2));\r\n\r\n      return Response.json({\r\n        success: true,\r\n        ...newBooking\r\n      });\r\n    }\r\n\r\n    return Response.json({ error: 'Invalid action' }, { status: 400 });\r\n  } catch (error) {\r\n    console.error('Booking error:', error);\r\n    return Response.json({ error: 'Failed to create booking' }, { status: 500 });\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}}]
}