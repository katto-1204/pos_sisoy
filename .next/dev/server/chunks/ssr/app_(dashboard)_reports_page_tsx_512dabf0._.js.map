{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Administrator/Downloads/pos-booking-system/app/%28dashboard%29/reports/page.tsx"],"sourcesContent":["\"use client\"\n\nimport { useState, useEffect } from \"react\"\nimport { storage, type Booking } from \"@/lib/storage\"\n\nexport default function ReportsPage() {\n  const [bookings, setBookings] = useState<Booking[]>([])\n  const [dateRange, setDateRange] = useState({\n    start: new Date(Date.now() - 30 * 24 * 60 * 60 * 1000).toISOString().split(\"T\")[0],\n    end: new Date().toISOString().split(\"T\")[0],\n  })\n\n  useEffect(() => {\n    setBookings(storage.getBookings())\n  }, [])\n\n  const getFilteredBookings = () => {\n    return bookings.filter((b) => {\n      const date = b.dateFrom\n      return date >= dateRange.start && date <= dateRange.end && b.status !== \"cancelled\"\n    })\n  }\n\n  const calculateStats = () => {\n    const filtered = getFilteredBookings()\n    const totalBookings = filtered.length\n    const totalRevenue = filtered.filter((b) => b.paymentStatus === \"paid\").reduce((sum, b) => sum + b.totalAmount, 0)\n    const avgBookingValue = totalBookings > 0 ? totalRevenue / totalBookings : 0\n\n    return { totalBookings, totalRevenue, avgBookingValue }\n  }\n\n  const getDailySalesData = () => {\n    const filtered = getFilteredBookings()\n    const dailyData: { [key: string]: number } = {}\n\n    filtered.forEach((b) => {\n      if (!dailyData[b.dateFrom]) {\n        dailyData[b.dateFrom] = 0\n      }\n      dailyData[b.dateFrom] += b.totalAmount\n    })\n\n    return Object.entries(dailyData)\n      .sort(([dateA], [dateB]) => dateA.localeCompare(dateB))\n      .slice(-7)\n  }\n\n  const getAccommodationBreakdown = () => {\n    const filtered = getFilteredBookings()\n    const breakdown: { [key: string]: { count: number; revenue: number } } = {}\n\n    filtered.forEach((b) => {\n      const acc = storage.getAccommodations().find((a) => a.id === b.accommodationId)\n      if (acc) {\n        if (!breakdown[acc.name]) {\n          breakdown[acc.name] = { count: 0, revenue: 0 }\n        }\n        breakdown[acc.name].count++\n        breakdown[acc.name].revenue += b.totalAmount\n      }\n    })\n\n    return breakdown\n  }\n\n  const stats = calculateStats()\n  const dailySales = getDailySalesData()\n  const accommodationBreakdown = getAccommodationBreakdown()\n\n  const handleExportCSV = () => {\n    const filtered = getFilteredBookings()\n    const csv = [\n      [\"Date\", \"Client\", \"Accommodation\", \"Amount\", \"Status\"],\n      ...filtered.map((b) => {\n        const client = storage.getClients().find((c) => c.id === b.clientId)\n        const acc = storage.getAccommodations().find((a) => a.id === b.accommodationId)\n        return [b.dateFrom, `${client?.firstName} ${client?.lastName}`, acc?.name, b.totalAmount, b.status]\n      }),\n    ]\n      .map((row) => row.join(\",\"))\n      .join(\"\\n\")\n\n    const blob = new Blob([csv], { type: \"text/csv\" })\n    const url = window.URL.createObjectURL(blob)\n    const a = document.createElement(\"a\")\n    a.href = url\n    a.download = `report-${dateRange.start}.csv`\n    a.click()\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <h1 className=\"text-3xl font-bold text-(--primary-blue)\">Reports</h1>\n\n      {/* Date Range Filter */}\n      <div className=\"bg-white border border-(--gray-light) rounded p-4 flex gap-4 items-end\">\n        <div>\n          <label className=\"block text-sm font-bold text-(--gray-dark) mb-1\">From</label>\n          <input\n            type=\"date\"\n            value={dateRange.start}\n            onChange={(e) => setDateRange({ ...dateRange, start: e.target.value })}\n            className=\"px-3 py-2 border border-(--gray-light) rounded\"\n          />\n        </div>\n        <div>\n          <label className=\"block text-sm font-bold text-(--gray-dark) mb-1\">To</label>\n          <input\n            type=\"date\"\n            value={dateRange.end}\n            onChange={(e) => setDateRange({ ...dateRange, end: e.target.value })}\n            className=\"px-3 py-2 border border-(--gray-light) rounded\"\n          />\n        </div>\n        <button\n          onClick={handleExportCSV}\n          className=\"px-4 py-2 bg-(--yellow) text-(--gray-dark) rounded font-bold hover:bg-yellow-400\"\n        >\n          Export CSV\n        </button>\n      </div>\n\n      {/* Key Metrics */}\n      <div className=\"grid grid-cols-3 gap-4\">\n        <div className=\"bg-white border border-(--gray-light) rounded p-6\">\n          <p className=\"text-sm text-(--gray-dark) mb-1\">Total Bookings</p>\n          <p className=\"text-3xl font-bold text-(--primary-blue)\">{stats.totalBookings}</p>\n        </div>\n        <div className=\"bg-white border border-(--gray-light) rounded p-6\">\n          <p className=\"text-sm text-(--gray-dark) mb-1\">Total Revenue</p>\n          <p className=\"text-3xl font-bold text-(--primary-blue)\">₱{stats.totalRevenue.toLocaleString()}</p>\n        </div>\n        <div className=\"bg-white border border-(--gray-light) rounded p-6\">\n          <p className=\"text-sm text-(--gray-dark) mb-1\">Avg. Booking Value</p>\n          <p className=\"text-3xl font-bold text-(--primary-blue)\">\n            ₱{Math.round(stats.avgBookingValue).toLocaleString()}\n          </p>\n        </div>\n      </div>\n\n      {/* Daily Sales */}\n      <div className=\"bg-white border border-(--gray-light) rounded p-6\">\n        <h2 className=\"text-lg font-bold text-(--gray-dark) mb-4\">Last 7 Days Sales</h2>\n        <div className=\"space-y-2\">\n          {dailySales.map(([date, amount]) => (\n            <div key={date} className=\"flex items-center gap-4\">\n              <span className=\"w-24 text-sm font-bold\">{date}</span>\n              <div className=\"flex-1 bg-(--gray-bg) rounded h-8 relative overflow-hidden\">\n                <div\n                  className=\"bg-(--yellow) h-full transition-all\"\n                  style={{\n                    width: `${Math.min(100, (amount / Math.max(...dailySales.map((d) => d[1]))) * 100)}%`,\n                  }}\n                />\n              </div>\n              <span className=\"w-32 text-right font-bold\">₱{amount.toLocaleString()}</span>\n            </div>\n          ))}\n        </div>\n      </div>\n\n      {/* Accommodation Breakdown */}\n      <div className=\"bg-white border border-(--gray-light) rounded p-6\">\n        <h2 className=\"text-lg font-bold text-(--gray-dark) mb-4\">Accommodation Performance</h2>\n        <div className=\"overflow-x-auto\">\n          <table className=\"w-full\">\n            <thead className=\"bg-(--gray-bg) border-b border-(--gray-light)\">\n              <tr>\n                <th className=\"text-left py-2 px-4 font-bold\">Accommodation</th>\n                <th className=\"text-left py-2 px-4 font-bold\">Bookings</th>\n                <th className=\"text-left py-2 px-4 font-bold\">Revenue</th>\n                <th className=\"text-left py-2 px-4 font-bold\">Avg/Booking</th>\n              </tr>\n            </thead>\n            <tbody>\n              {Object.entries(accommodationBreakdown).map(([name, data]) => (\n                <tr key={name} className=\"border-b border-(--gray-light)\">\n                  <td className=\"py-3 px-4\">{name}</td>\n                  <td className=\"py-3 px-4 font-bold\">{data.count}</td>\n                  <td className=\"py-3 px-4 font-bold\">₱{data.revenue.toLocaleString()}</td>\n                  <td className=\"py-3 px-4\">₱{Math.round(data.revenue / data.count).toLocaleString()}</td>\n                </tr>\n              ))}\n            </tbody>\n          </table>\n        </div>\n      </div>\n    </div>\n  )\n}\n"],"names":[],"mappings":"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"}}]
}