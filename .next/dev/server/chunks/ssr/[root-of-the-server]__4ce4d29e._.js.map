{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 22, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Administrator/Downloads/pos_sisoy/components/booking/booking-complete-modal.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport { useState } from \"react\"\r\nimport jsPDF from \"jspdf\"\r\nimport type { Booking } from \"@/lib/storage\"\r\n\r\ninterface BookingCompleteModalProps {\r\n  booking: Booking\r\n  clientName: string\r\n  accommodationName: string\r\n  checkIn: string\r\n  checkOut: string\r\n  nights: number\r\n  onClose: () => void\r\n}\r\n\r\nexport default function BookingCompleteModal({\r\n  booking,\r\n  clientName,\r\n  accommodationName,\r\n  checkIn,\r\n  checkOut,\r\n  nights,\r\n  onClose,\r\n}: BookingCompleteModalProps) {\r\n  const [isGeneratingPDF, setIsGeneratingPDF] = useState(false)\r\n\r\n  const generatePDFReceipt = () => {\r\n    setIsGeneratingPDF(true)\r\n\r\n    try {\r\n      const doc = new jsPDF()\r\n      const pageWidth = doc.internal.pageSize.getWidth()\r\n      const pageHeight = doc.internal.pageSize.getHeight()\r\n\r\n      // Set colors\r\n      const blueColor = [30, 58, 138] // #1E3A8A\r\n      const yellowColor = [250, 204, 21] // #FACC15\r\n      const grayColor = [50, 50, 50]\r\n\r\n      // Header with background\r\n      doc.setFillColor(blueColor[0], blueColor[1], blueColor[2])\r\n      doc.rect(0, 0, pageWidth, 40, \"F\")\r\n\r\n      doc.setTextColor(250, 204, 21)\r\n      doc.setFontSize(28)\r\n      doc.setFont(\"helvetica\", \"bold\")\r\n      doc.text(\"SISOY POS\", pageWidth / 2, 20, { align: \"center\" })\r\n\r\n      doc.setTextColor(255, 255, 255)\r\n      doc.setFontSize(10)\r\n      doc.text(\"BOOKING RECEIPT\", pageWidth / 2, 32, { align: \"center\" })\r\n\r\n      // Receipt details\r\n      let yPosition = 50\r\n\r\n      // Booking ID and Date\r\n      doc.setTextColor(grayColor[0], grayColor[1], grayColor[2])\r\n      doc.setFontSize(10)\r\n      doc.setFont(\"helvetica\", \"normal\")\r\n\r\n      doc.text(`Booking ID: ${booking.id}`, 20, yPosition)\r\n      yPosition += 8\r\n      doc.text(`Date Issued: ${new Date().toLocaleDateString()}`, 20, yPosition)\r\n      yPosition += 12\r\n\r\n      // Divider\r\n      doc.setDrawColor(blueColor[0], blueColor[1], blueColor[2])\r\n      doc.line(20, yPosition, pageWidth - 20, yPosition)\r\n      yPosition += 10\r\n\r\n      // Guest Information\r\n      doc.setFont(\"helvetica\", \"bold\")\r\n      doc.setFontSize(11)\r\n      doc.setTextColor(blueColor[0], blueColor[1], blueColor[2])\r\n      doc.text(\"GUEST INFORMATION\", 20, yPosition)\r\n      yPosition += 8\r\n\r\n      doc.setFont(\"helvetica\", \"normal\")\r\n      doc.setFontSize(10)\r\n      doc.setTextColor(grayColor[0], grayColor[1], grayColor[2])\r\n      doc.text(`Name: ${clientName}`, 25, yPosition)\r\n      yPosition += 6\r\n      doc.text(`Booking Date: ${new Date(booking.createdAt).toLocaleDateString()}`, 25, yPosition)\r\n      yPosition += 12\r\n\r\n      // Accommodation Details\r\n      doc.setFont(\"helvetica\", \"bold\")\r\n      doc.setFontSize(11)\r\n      doc.setTextColor(blueColor[0], blueColor[1], blueColor[2])\r\n      doc.text(\"ACCOMMODATION DETAILS\", 20, yPosition)\r\n      yPosition += 8\r\n\r\n      doc.setFont(\"helvetica\", \"normal\")\r\n      doc.setFontSize(10)\r\n      doc.setTextColor(grayColor[0], grayColor[1], grayColor[2])\r\n      doc.text(`Accommodation: ${accommodationName}`, 25, yPosition)\r\n      yPosition += 6\r\n      doc.text(`Check-In: ${new Date(checkIn).toLocaleDateString()}`, 25, yPosition)\r\n      yPosition += 6\r\n      doc.text(`Check-Out: ${new Date(checkOut).toLocaleDateString()}`, 25, yPosition)\r\n      yPosition += 6\r\n      doc.text(`Number of Nights: ${nights}`, 25, yPosition)\r\n      yPosition += 12\r\n\r\n      // Billing Summary\r\n      doc.setFont(\"helvetica\", \"bold\")\r\n      doc.setFontSize(11)\r\n      doc.setTextColor(blueColor[0], blueColor[1], blueColor[2])\r\n      doc.text(\"BILLING SUMMARY\", 20, yPosition)\r\n      yPosition += 8\r\n\r\n      // Summary table\r\n      const tableData = [\r\n        [\"Description\", \"Amount\"],\r\n        [`${accommodationName} x ${nights} nights`, `₱${booking.totalAmount.toLocaleString()}`],\r\n        [\"Discount\", \"₱0.00\"],\r\n        [\"Service Charge\", \"₱0.00\"],\r\n        [\"Tax (0%)\", \"₱0.00\"],\r\n      ]\r\n\r\n      doc.setFontSize(10)\r\n      doc.setTextColor(grayColor[0], grayColor[1], grayColor[2])\r\n\r\n      tableData.forEach((row, index) => {\r\n        const isHeader = index === 0\r\n        if (isHeader) doc.setFont(\"helvetica\", \"bold\")\r\n        else doc.setFont(\"helvetica\", \"normal\")\r\n\r\n        doc.text(row[0], 25, yPosition)\r\n        doc.text(row[1], pageWidth - 40, yPosition, { align: \"right\" })\r\n        yPosition += 6\r\n      })\r\n\r\n      // Total\r\n      yPosition += 2\r\n      doc.setDrawColor(blueColor[0], blueColor[1], blueColor[2])\r\n      doc.line(20, yPosition, pageWidth - 20, yPosition)\r\n      yPosition += 6\r\n\r\n      doc.setFont(\"helvetica\", \"bold\")\r\n      doc.setFontSize(12)\r\n      doc.setTextColor(blueColor[0], blueColor[1], blueColor[2])\r\n      doc.text(\"TOTAL AMOUNT\", 25, yPosition)\r\n      doc.text(`₱${booking.totalAmount.toLocaleString()}`, pageWidth - 40, yPosition, { align: \"right\" })\r\n\r\n      yPosition += 14\r\n\r\n      // Payment Info\r\n      doc.setDrawColor(blueColor[0], blueColor[1], blueColor[2])\r\n      doc.line(20, yPosition, pageWidth - 20, yPosition)\r\n      yPosition += 8\r\n\r\n      doc.setFont(\"helvetica\", \"bold\")\r\n      doc.setFontSize(10)\r\n      doc.setTextColor(blueColor[0], blueColor[1], blueColor[2])\r\n      doc.text(\"PAYMENT INFORMATION\", 20, yPosition)\r\n      yPosition += 8\r\n\r\n      doc.setFont(\"helvetica\", \"normal\")\r\n      doc.setFontSize(10)\r\n      doc.setTextColor(grayColor[0], grayColor[1], grayColor[2])\r\n      doc.text(`Payment Status: PAID`, 25, yPosition)\r\n      yPosition += 6\r\n      doc.text(`Transaction ID: ${booking.transactionId}`, 25, yPosition)\r\n      yPosition += 12\r\n\r\n      // Footer\r\n      doc.setDrawColor(blueColor[0], blueColor[1], blueColor[2])\r\n      doc.line(20, yPosition, pageWidth - 20, yPosition)\r\n      yPosition += 8\r\n\r\n      doc.setFont(\"helvetica\", \"italic\")\r\n      doc.setFontSize(9)\r\n      doc.setTextColor(150, 150, 150)\r\n      doc.text(\"Thank you for booking with Sisoy POS\", pageWidth / 2, yPosition, { align: \"center\" })\r\n      yPosition += 5\r\n      doc.text(\"For inquiries, please contact us\", pageWidth / 2, yPosition, { align: \"center\" })\r\n\r\n      // Save PDF\r\n      doc.save(`Receipt_${booking.id}.pdf`)\r\n    } catch (error) {\r\n      console.error(\"Error generating PDF:\", error)\r\n      alert(\"Failed to generate receipt. Please try again.\")\r\n    } finally {\r\n      setIsGeneratingPDF(false)\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4\">\r\n      <div className=\"bg-white rounded-lg p-8 max-w-md w-full shadow-2xl space-y-6 animate-in\">\r\n        {/* Success Icon */}\r\n        <div className=\"flex justify-center\">\r\n          <div className=\"bg-green-100 rounded-full p-4\">\r\n            <svg className=\"w-12 h-12 text-green-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 13l4 4L19 7\" />\r\n            </svg>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Title */}\r\n        <div className=\"text-center\">\r\n          <h2 className=\"text-2xl font-bold text-blue-900 mb-2\">Booking Complete!</h2>\r\n          <p className=\"text-gray-600 text-sm\">Your reservation has been confirmed</p>\r\n        </div>\r\n\r\n        {/* Booking Details */}\r\n        <div className=\"bg-blue-50 rounded-lg p-4 space-y-3 text-sm\">\r\n          <div className=\"flex justify-between\">\r\n            <span className=\"text-gray-600\">Booking ID</span>\r\n            <span className=\"font-bold text-gray-900\">{booking.id}</span>\r\n          </div>\r\n          <div className=\"flex justify-between\">\r\n            <span className=\"text-gray-600\">Room</span>\r\n            <span className=\"font-bold text-gray-900\">{accommodationName}</span>\r\n          </div>\r\n          <div className=\"flex justify-between\">\r\n            <span className=\"text-gray-600\">Nights</span>\r\n            <span className=\"font-bold text-gray-900\">{nights}</span>\r\n          </div>\r\n          <div className=\"border-t border-blue-200 pt-3 mt-3 flex justify-between\">\r\n            <span className=\"font-bold text-gray-800\">Total Amount</span>\r\n            <span className=\"font-bold text-yellow-500 text-lg\">₱{booking.totalAmount.toLocaleString()}</span>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Actions */}\r\n        <div className=\"space-y-3\">\r\n          <button\r\n            onClick={generatePDFReceipt}\r\n            disabled={isGeneratingPDF}\r\n            className=\"w-full py-3 bg-blue-900 text-white font-bold rounded hover:bg-blue-800 transition-colors disabled:opacity-50 flex items-center justify-center gap-2\"\r\n          >\r\n            <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path\r\n                strokeLinecap=\"round\"\r\n                strokeLinejoin=\"round\"\r\n                strokeWidth={2}\r\n                d=\"M12 19l9 2-9-18-9 18 9-2m0 0v-8m0 8l-6-4m6 4l6-4\"\r\n              />\r\n            </svg>\r\n            {isGeneratingPDF ? \"Generating...\" : \"Download Receipt PDF\"}\r\n          </button>\r\n          <button\r\n            onClick={onClose}\r\n            className=\"w-full py-3 bg-yellow-400 text-blue-900 font-bold rounded hover:bg-yellow-500 transition-colors\"\r\n          >\r\n            Done\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 452, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Administrator/Downloads/pos_sisoy/app/%28dashboard%29/booking/payment/page.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport { useState } from \"react\"\r\nimport { useRouter, useSearchParams } from \"next/navigation\"\r\nimport { storage } from \"@/lib/storage\"\r\nimport BookingCompleteModal from \"@/components/booking/booking-complete-modal\"\r\n\r\nexport default function PaymentPage() {\r\n  const router = useRouter()\r\n  const searchParams = useSearchParams()\r\n  const amount = Number.parseFloat(searchParams.get(\"amount\") || \"0\")\r\n  const bookingId = searchParams.get(\"bookingId\") || \"\"\r\n\r\n  const [paymentMethod, setPaymentMethod] = useState(\"cash\")\r\n  const [isProcessing, setIsProcessing] = useState(false)\r\n  const [completedBooking, setCompletedBooking] = useState<any>(null)\r\n  const [completedClientName, setCompletedClientName] = useState<string | null>(null)\r\n  const [completedAccommodationName, setCompletedAccommodationName] = useState<string | null>(null)\r\n\r\n  const handleSimulatePayment = async () => {\r\n    setIsProcessing(true)\r\n\r\n    // Simulate API call\r\n    await new Promise((resolve) => setTimeout(resolve, 2000))\r\n\r\n    const tempBooking = JSON.parse(sessionStorage.getItem(\"tempBooking\") || \"{}\")\r\n\r\n    const booking = {\r\n      ...tempBooking,\r\n      id: bookingId || tempBooking.id,\r\n      status: \"confirmed\" as const,\r\n      paymentStatus: \"paid\" as const,\r\n      transactionId: `TXN${Date.now()}`,\r\n    }\r\n\r\n    const API_BASE = (typeof process !== 'undefined' && process.env && process.env.NEXT_PUBLIC_API_URL)\r\n      ? process.env.NEXT_PUBLIC_API_URL\r\n      : 'http://localhost:3000/api'\r\n\r\n    // Try to create booking on server first when API is configured\r\n    if (typeof window !== 'undefined' && API_BASE) {\r\n      // quick ping to backend to make sure it's reachable and DB connection ok\r\n      try {\r\n        const ping = await fetch(`${API_BASE}/test_db_conn`)\r\n        if (!ping.ok) {\r\n          alert('Booking failed: server API unreachable (ping returned ' + ping.status + '). Please ensure Apache/MySQL are running and backend is reachable.')\r\n          setIsProcessing(false)\r\n          return\r\n        }\r\n        try {\r\n          const pj = await ping.json()\r\n          if (!pj || pj.connected !== true) {\r\n            alert('Booking failed: server DB connection is not ready. Check backend DB settings and XAMPP services.')\r\n            setIsProcessing(false)\r\n            return\r\n          }\r\n        } catch (e) {\r\n          // non-json response; continue and let subsequent calls fail with clearer errors\r\n        }\r\n      } catch (e) {\r\n        alert('Booking failed: server API not reachable. Please start the backend (Apache/MySQL) and verify NEXT_PUBLIC_API_URL.')\r\n        setIsProcessing(false)\r\n        return\r\n      }\r\n      try {\r\n        // Ensure the customer exists on server. Search by email/phone/name first; if not found, create.\r\n        let customerIdToUse = booking.clientId\r\n        const clientObj = storage.getClients().find((c: any) => c.id === booking.clientId)\r\n        if (clientObj) {\r\n          try {\r\n            // Prefer searching by email, then phone, then name\r\n            let searchTerm = ''\r\n            if (clientObj.email) searchTerm = clientObj.email\r\n            else if (clientObj.phoneNumber) searchTerm = clientObj.phoneNumber\r\n            else searchTerm = `${clientObj.firstName} ${clientObj.lastName}`\r\n\r\n            if (searchTerm && searchTerm.length >= 2) {\r\n              try {\r\n                const sresp = await fetch(`${API_BASE}/customers?action=search&term=${encodeURIComponent(searchTerm)}`)\r\n                if (sresp.ok) {\r\n                  const sjson = await sresp.json()\r\n                  if (sjson && Array.isArray(sjson.data) && sjson.data.length > 0) {\r\n                    // Try to find best match (email or phone)\r\n                    const match = sjson.data.find((c: any) =>\r\n                      (clientObj.email && c.email === clientObj.email) ||\r\n                      (clientObj.phoneNumber && c.phone === clientObj.phoneNumber) ||\r\n                      (c.first_name === clientObj.firstName && c.last_name === clientObj.lastName)\r\n                    )\r\n                    if (match && match.id) {\r\n                      customerIdToUse = String(match.id)\r\n                    }\r\n                  }\r\n                }\r\n              } catch (e) {\r\n                // ignore search failures and fall back to create\r\n              }\r\n            }\r\n\r\n            // If still not matched (or search not available), create customer on server\r\n            if (!customerIdToUse || String(customerIdToUse).length > 10) {\r\n              // numeric local IDs generated by Date.now() can be long - treat them as local-only\r\n              const createResp = await fetch(`${API_BASE}/customers?action=create`, {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({\r\n                  first_name: clientObj.firstName,\r\n                  last_name: clientObj.lastName,\r\n                  email: clientObj.email || '',\r\n                  phone: clientObj.phoneNumber || '',\r\n                  address: clientObj.address || '',\r\n                }),\r\n              })\r\n              if (createResp.ok) {\r\n                const cjson = await createResp.json()\r\n                if (cjson && cjson.id) {\r\n                  customerIdToUse = String(cjson.id)\r\n                  // update local client id to server id for consistency\r\n                  try {\r\n                    const clients = storage.getClients()\r\n                    const idx = clients.findIndex((c: any) => c.id === clientObj.id)\r\n                    if (idx !== -1) {\r\n                      clients[idx].id = customerIdToUse\r\n                      localStorage.setItem('pos_clients', JSON.stringify(clients))\r\n                    }\r\n                  } catch {}\r\n                }\r\n              }\r\n            }\r\n          } catch (e) {\r\n            // ignore and continue — will be handled later\r\n          }\r\n        }\r\n\r\n        const payload = {\r\n          customer_id: customerIdToUse,\r\n          accommodation_id: booking.accommodationId,\r\n          accommodation_name: (() => {\r\n            const acc = storage.getAccommodations().find((a) => a.id === booking.accommodationId)\r\n            return acc ? acc.name : undefined\r\n          })(),\r\n          check_in: booking.dateFrom,\r\n          check_out: booking.dateTo,\r\n          guests: 1,\r\n          total_price: booking.totalAmount,\r\n        }\r\n\r\n        const resp = await fetch(`${API_BASE}/bookings?action=create`, {\r\n          method: 'POST',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify(payload),\r\n        })\r\n\r\n        if (resp.ok) {\r\n          const json = await resp.json()\r\n          const serverId = json && json.id ? String(json.id) : booking.id\r\n          const serverBooking = { ...booking, id: serverId }\r\n          // ensure booking references the server customer id\r\n          serverBooking.clientId = customerIdToUse\r\n\r\n          sessionStorage.removeItem(\"tempBooking\")\r\n          \r\n          // Fetch updated bookings list from server and sync to localStorage\r\n          try {\r\n            const listResp = await fetch(`${API_BASE}/bookings?action=list`)\r\n            if (listResp.ok) {\r\n              const listJson = await listResp.json()\r\n              if (listJson && Array.isArray(listJson.data)) {\r\n                // Convert server bookings to client format and store\r\n                const clientBookings = listJson.data.map((b: any) => ({\r\n                  id: String(b.id),\r\n                  clientId: String(b.customer_id),\r\n                  accommodationId: String(b.accommodation_id),\r\n                  dateFrom: b.check_in,\r\n                  dateTo: b.check_out,\r\n                  status: b.status || 'confirmed',\r\n                  totalAmount: parseFloat(b.total_price) || 0,\r\n                  createdAt: b.created_at || new Date().toISOString(),\r\n                  paymentStatus: 'paid',\r\n                }))\r\n                localStorage.setItem('pos_bookings', JSON.stringify(clientBookings))\r\n              }\r\n            }\r\n          } catch (e) {\r\n            // non-fatal: continue even if list fetch fails\r\n          }\r\n          \r\n          setIsProcessing(false)\r\n          setCompletedBooking(serverBooking)\r\n          // determine client name for modal (prefer clientObj if available)\r\n          const clientObj = storage.getClients().find((c: any) => c.id === booking.clientId) || null\r\n          if (clientObj) setCompletedClientName(`${clientObj.firstName} ${clientObj.lastName}`)\r\n          else setCompletedClientName(null)\r\n          const accommodation = storage.getAccommodations().find((a) => a.id === serverBooking.accommodationId)\r\n          setCompletedAccommodationName(accommodation?.name || null)\r\n          return\r\n        } else {\r\n          // Try to parse error body\r\n          let errText = 'Failed to create booking on server'\r\n          try {\r\n            const errJson = await resp.json()\r\n            if (errJson && errJson.error) errText = String(errJson.error)\r\n          } catch {}\r\n          alert(errText)\r\n          setIsProcessing(false)\r\n          return\r\n        }\r\n      } catch (e) {\r\n        // fall back to local-only if server call fails\r\n      }\r\n    }\r\n\r\n    // If API not configured or unavailable, prevent booking — require server persistence\r\n    alert('Booking failed: server API not configured or unreachable. Booking must be created on the server.')\r\n    setIsProcessing(false)\r\n    return\r\n  }\r\n\r\n  const handleCloseModal = () => {\r\n    setCompletedBooking(null)\r\n    router.push(\"/dashboard\")\r\n  }\r\n\r\n  if (completedBooking) {\r\n    const checkIn = new Date(completedBooking.dateFrom)\r\n    const checkOut = new Date(completedBooking.dateTo)\r\n    const nights = Math.floor((checkOut.getTime() - checkIn.getTime()) / (1000 * 60 * 60 * 24))\r\n\r\n    return (\r\n      <BookingCompleteModal\r\n        booking={completedBooking}\r\n        clientName={completedClientName || 'Guest'}\r\n        accommodationName={completedAccommodationName || 'Accommodation'}\r\n        checkIn={completedBooking.dateFrom}\r\n        checkOut={completedBooking.dateTo}\r\n        nights={nights}\r\n        onClose={handleCloseModal}\r\n      />\r\n    )\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 flex items-center justify-center p-4\">\r\n      <div className=\"w-full max-w-md bg-white border border-gray-200 rounded-lg p-8 shadow-lg\">\r\n        <h1 className=\"text-3xl font-bold text-blue-900 mb-6 text-center\">Confirm Payment</h1>\r\n\r\n        <div className=\"bg-blue-50 p-6 rounded mb-6 text-center border border-blue-200\">\r\n          <p className=\"text-sm text-gray-600 mb-2 font-medium\">Total Amount Due</p>\r\n          <p className=\"text-4xl font-bold text-yellow-500\">₱{amount.toLocaleString()}</p>\r\n        </div>\r\n\r\n        <div className=\"space-y-4 mb-6\">\r\n          <label className=\"block\">\r\n            <span className=\"block text-sm font-bold text-gray-700 mb-3\">Payment Method</span>\r\n            <select\r\n              value={paymentMethod}\r\n              onChange={(e) => setPaymentMethod(e.target.value)}\r\n              className=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n            >\r\n              <option value=\"cash\">Cash Payment</option>\r\n              <option value=\"gcash\">GCash</option>\r\n              <option value=\"credit\">Credit Card</option>\r\n              <option value=\"bank\">Bank Transfer</option>\r\n            </select>\r\n          </label>\r\n        </div>\r\n\r\n        <button\r\n          onClick={handleSimulatePayment}\r\n          disabled={isProcessing}\r\n          className=\"w-full py-3 bg-yellow-400 text-blue-900 font-bold rounded-lg hover:bg-yellow-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors\"\r\n        >\r\n          {isProcessing ? \"Processing Payment...\" : \"Confirm & Process Payment\"}\r\n        </button>\r\n\r\n        <div className=\"mt-6 p-4 bg-blue-50 rounded-lg border border-blue-200 text-xs text-gray-700\">\r\n          <p className=\"font-bold mb-1 text-blue-900\">Payment Confirmation</p>\r\n          <p>Payment will be processed securely. A receipt will be generated upon completion.</p>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AALA;;;;;;AAOe,SAAS;IACtB,MAAM,SAAS,IAAA,+IAAS;IACxB,MAAM,eAAe,IAAA,qJAAe;IACpC,MAAM,SAAS,OAAO,UAAU,CAAC,aAAa,GAAG,CAAC,aAAa;IAC/D,MAAM,YAAY,aAAa,GAAG,CAAC,gBAAgB;IAEnD,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,iNAAQ,EAAC;IACnD,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,iNAAQ,EAAC;IACjD,MAAM,CAAC,kBAAkB,oBAAoB,GAAG,IAAA,iNAAQ,EAAM;IAC9D,MAAM,CAAC,qBAAqB,uBAAuB,GAAG,IAAA,iNAAQ,EAAgB;IAC9E,MAAM,CAAC,4BAA4B,8BAA8B,GAAG,IAAA,iNAAQ,EAAgB;IAE5F,MAAM,wBAAwB;QAC5B,gBAAgB;QAEhB,oBAAoB;QACpB,MAAM,IAAI,QAAQ,CAAC,UAAY,WAAW,SAAS;QAEnD,MAAM,cAAc,KAAK,KAAK,CAAC,eAAe,OAAO,CAAC,kBAAkB;QAExE,MAAM,UAAU;YACd,GAAG,WAAW;YACd,IAAI,aAAa,YAAY,EAAE;YAC/B,QAAQ;YACR,eAAe;YACf,eAAe,CAAC,GAAG,EAAE,KAAK,GAAG,IAAI;QACnC;QAEA,MAAM,WAAW,AAAC,OAAO,YAAY,eAAe,QAAQ,GAAG,oIAE3D;QAEJ,+DAA+D;QAC/D;;QA2KA,qFAAqF;QACrF,MAAM;QACN,gBAAgB;QAChB;IACF;IAEA,MAAM,mBAAmB;QACvB,oBAAoB;QACpB,OAAO,IAAI,CAAC;IACd;IAEA,IAAI,kBAAkB;QACpB,MAAM,UAAU,IAAI,KAAK,iBAAiB,QAAQ;QAClD,MAAM,WAAW,IAAI,KAAK,iBAAiB,MAAM;QACjD,MAAM,SAAS,KAAK,KAAK,CAAC,CAAC,SAAS,OAAO,KAAK,QAAQ,OAAO,EAAE,IAAI,CAAC,OAAO,KAAK,KAAK,EAAE;QAEzF,qBACE,8OAAC,iKAAoB;YACnB,SAAS;YACT,YAAY,uBAAuB;YACnC,mBAAmB,8BAA8B;YACjD,SAAS,iBAAiB,QAAQ;YAClC,UAAU,iBAAiB,MAAM;YACjC,QAAQ;YACR,SAAS;;;;;;IAGf;IAEA,qBACE,8OAAC;QAAI,WAAU;kBACb,cAAA,8OAAC;YAAI,WAAU;;8BACb,8OAAC;oBAAG,WAAU;8BAAoD;;;;;;8BAElE,8OAAC;oBAAI,WAAU;;sCACb,8OAAC;4BAAE,WAAU;sCAAyC;;;;;;sCACtD,8OAAC;4BAAE,WAAU;;gCAAqC;gCAAE,OAAO,cAAc;;;;;;;;;;;;;8BAG3E,8OAAC;oBAAI,WAAU;8BACb,cAAA,8OAAC;wBAAM,WAAU;;0CACf,8OAAC;gCAAK,WAAU;0CAA6C;;;;;;0CAC7D,8OAAC;gCACC,OAAO;gCACP,UAAU,CAAC,IAAM,iBAAiB,EAAE,MAAM,CAAC,KAAK;gCAChD,WAAU;;kDAEV,8OAAC;wCAAO,OAAM;kDAAO;;;;;;kDACrB,8OAAC;wCAAO,OAAM;kDAAQ;;;;;;kDACtB,8OAAC;wCAAO,OAAM;kDAAS;;;;;;kDACvB,8OAAC;wCAAO,OAAM;kDAAO;;;;;;;;;;;;;;;;;;;;;;;8BAK3B,8OAAC;oBACC,SAAS;oBACT,UAAU;oBACV,WAAU;8BAET,eAAe,0BAA0B;;;;;;8BAG5C,8OAAC;oBAAI,WAAU;;sCACb,8OAAC;4BAAE,WAAU;sCAA+B;;;;;;sCAC5C,8OAAC;sCAAE;;;;;;;;;;;;;;;;;;;;;;;AAKb"}}]
}