{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 112, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Administrator/Downloads/pos_sisoy/lib/db.js"],"sourcesContent":["import mysql from 'mysql2/promise';\r\n\r\nlet pool = null;\r\n\r\nexport async function getConnection() {\r\n  if (!pool) {\r\n    pool = mysql.createPool({\r\n      host: process.env.DB_HOST || '127.0.0.1',\r\n      user: process.env.DB_USER || 'root',\r\n      password: process.env.DB_PASS || '',\r\n      database: process.env.DB_NAME || 'sisoy_booking',\r\n      port: parseInt(process.env.DB_PORT || '3306'),\r\n      waitForConnections: true,\r\n      connectionLimit: 10,\r\n      queueLimit: 0,\r\n    });\r\n  }\r\n  return pool;\r\n}\r\n\r\nexport async function query(sql, values = []) {\r\n  const pool = await getConnection();\r\n  const connection = await pool.getConnection();\r\n  try {\r\n    const [results] = await connection.execute(sql, values);\r\n    return results;\r\n  } finally {\r\n    connection.release();\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,IAAI,OAAO;AAEJ,eAAe;IACpB,IAAI,CAAC,MAAM;QACT,OAAO,8IAAK,CAAC,UAAU,CAAC;YACtB,MAAM,QAAQ,GAAG,CAAC,OAAO,IAAI;YAC7B,MAAM,QAAQ,GAAG,CAAC,OAAO,IAAI;YAC7B,UAAU,QAAQ,GAAG,CAAC,OAAO,IAAI;YACjC,UAAU,QAAQ,GAAG,CAAC,OAAO,IAAI;YACjC,MAAM,SAAS,QAAQ,GAAG,CAAC,OAAO,IAAI;YACtC,oBAAoB;YACpB,iBAAiB;YACjB,YAAY;QACd;IACF;IACA,OAAO;AACT;AAEO,eAAe,MAAM,GAAG,EAAE,SAAS,EAAE;IAC1C,MAAM,OAAO,MAAM;IACnB,MAAM,aAAa,MAAM,KAAK,aAAa;IAC3C,IAAI;QACF,MAAM,CAAC,QAAQ,GAAG,MAAM,WAAW,OAAO,CAAC,KAAK;QAChD,OAAO;IACT,SAAU;QACR,WAAW,OAAO;IACpB;AACF"}},
    {"offset": {"line": 150, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Administrator/Downloads/pos_sisoy/app/api/customers/route.js"],"sourcesContent":["import { query } from '@/lib/db.js';\r\n\r\nexport async function GET(request) {\r\n  try {\r\n    const searchParams = new URL(request.url).searchParams;\r\n    const action = searchParams.get('action');\r\n\r\n    if (action === 'list') {\r\n      const results = await query('SELECT * FROM customers ORDER BY created_at DESC');\r\n      return Response.json({ data: results });\r\n    }\r\n\r\n    if (action === 'search') {\r\n      const term = searchParams.get('term') || '';\r\n      if (term.length < 2) {\r\n        return Response.json({ data: [] });\r\n      }\r\n\r\n      const searchTerm = `%${term}%`;\r\n      const results = await query(\r\n        `SELECT * FROM customers \r\n         WHERE first_name LIKE ? OR last_name LIKE ? OR email LIKE ? OR phone LIKE ?\r\n         LIMIT 10`,\r\n        [searchTerm, searchTerm, searchTerm, searchTerm]\r\n      );\r\n\r\n      return Response.json({ data: results });\r\n    }\r\n\r\n    return Response.json({ error: 'Invalid action' }, { status: 400 });\r\n  } catch (error) {\r\n    console.error('Customer error:', error);\r\n    return Response.json({ error: 'Failed to fetch customers: ' + error.message }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function POST(request) {\r\n  try {\r\n    const searchParams = new URL(request.url).searchParams;\r\n    const action = searchParams.get('action');\r\n\r\n    if (action === 'create') {\r\n      const body = await request.json();\r\n\r\n      const results = await query(\r\n        `INSERT INTO customers (first_name, last_name, email, phone, address) \r\n         VALUES (?, ?, ?, ?, ?)`,\r\n        [\r\n          body.first_name || '',\r\n          body.last_name || '',\r\n          body.email || '',\r\n          body.phone || '',\r\n          body.address || '',\r\n        ]\r\n      );\r\n\r\n      // Fetch the newly created customer\r\n      const newCustomer = await query(\r\n        'SELECT * FROM customers WHERE id = ?',\r\n        [results.insertId]\r\n      );\r\n\r\n      return Response.json({ \r\n        success: true, \r\n        id: results.insertId,\r\n        ...newCustomer[0] \r\n      });\r\n    }\r\n\r\n    return Response.json({ error: 'Invalid action' }, { status: 400 });\r\n  } catch (error) {\r\n    console.error('Customer create error:', error);\r\n    return Response.json({ error: 'Failed to create customer: ' + error.message }, { status: 500 });\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;;AAEO,eAAe,IAAI,OAAO;IAC/B,IAAI;QACF,MAAM,eAAe,IAAI,IAAI,QAAQ,GAAG,EAAE,YAAY;QACtD,MAAM,SAAS,aAAa,GAAG,CAAC;QAEhC,IAAI,WAAW,QAAQ;YACrB,MAAM,UAAU,MAAM,IAAA,oHAAK,EAAC;YAC5B,OAAO,SAAS,IAAI,CAAC;gBAAE,MAAM;YAAQ;QACvC;QAEA,IAAI,WAAW,UAAU;YACvB,MAAM,OAAO,aAAa,GAAG,CAAC,WAAW;YACzC,IAAI,KAAK,MAAM,GAAG,GAAG;gBACnB,OAAO,SAAS,IAAI,CAAC;oBAAE,MAAM,EAAE;gBAAC;YAClC;YAEA,MAAM,aAAa,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC;YAC9B,MAAM,UAAU,MAAM,IAAA,oHAAK,EACzB,CAAC;;iBAEQ,CAAC,EACV;gBAAC;gBAAY;gBAAY;gBAAY;aAAW;YAGlD,OAAO,SAAS,IAAI,CAAC;gBAAE,MAAM;YAAQ;QACvC;QAEA,OAAO,SAAS,IAAI,CAAC;YAAE,OAAO;QAAiB,GAAG;YAAE,QAAQ;QAAI;IAClE,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,mBAAmB;QACjC,OAAO,SAAS,IAAI,CAAC;YAAE,OAAO,gCAAgC,MAAM,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IAC/F;AACF;AAEO,eAAe,KAAK,OAAO;IAChC,IAAI;QACF,MAAM,eAAe,IAAI,IAAI,QAAQ,GAAG,EAAE,YAAY;QACtD,MAAM,SAAS,aAAa,GAAG,CAAC;QAEhC,IAAI,WAAW,UAAU;YACvB,MAAM,OAAO,MAAM,QAAQ,IAAI;YAE/B,MAAM,UAAU,MAAM,IAAA,oHAAK,EACzB,CAAC;+BACsB,CAAC,EACxB;gBACE,KAAK,UAAU,IAAI;gBACnB,KAAK,SAAS,IAAI;gBAClB,KAAK,KAAK,IAAI;gBACd,KAAK,KAAK,IAAI;gBACd,KAAK,OAAO,IAAI;aACjB;YAGH,mCAAmC;YACnC,MAAM,cAAc,MAAM,IAAA,oHAAK,EAC7B,wCACA;gBAAC,QAAQ,QAAQ;aAAC;YAGpB,OAAO,SAAS,IAAI,CAAC;gBACnB,SAAS;gBACT,IAAI,QAAQ,QAAQ;gBACpB,GAAG,WAAW,CAAC,EAAE;YACnB;QACF;QAEA,OAAO,SAAS,IAAI,CAAC;YAAE,OAAO;QAAiB,GAAG;YAAE,QAAQ;QAAI;IAClE,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,0BAA0B;QACxC,OAAO,SAAS,IAAI,CAAC;YAAE,OAAO,gCAAgC,MAAM,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IAC/F;AACF"}}]
}