{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Administrator/Downloads/pos_sisoy/app/api/customers/route.js"],"sourcesContent":["import fs from 'fs';\r\nimport path from 'path';\r\n\r\nconst getFilePath = (filename) => path.join(process.cwd(), 'data', filename);\r\nconst ensureDir = () => {\r\n  const dir = path.join(process.cwd(), 'data');\r\n  if (!fs.existsSync(dir)) {\r\n    fs.mkdirSync(dir, { recursive: true });\r\n  }\r\n};\r\n\r\nexport async function GET(request) {\r\n  try {\r\n    ensureDir();\r\n    const searchParams = new URL(request.url).searchParams;\r\n    const action = searchParams.get('action');\r\n\r\n    if (action === 'list') {\r\n      const customersPath = getFilePath('customers.json');\r\n      if (!fs.existsSync(customersPath)) {\r\n        return Response.json({ data: [] });\r\n      }\r\n\r\n      const customers = JSON.parse(fs.readFileSync(customersPath, 'utf-8') || '[]');\r\n      return Response.json({ data: customers });\r\n    }\r\n\r\n    if (action === 'search') {\r\n      const term = searchParams.get('term') || '';\r\n      if (term.length < 2) {\r\n        return Response.json({ data: [] });\r\n      }\r\n\r\n      const customersPath = getFilePath('customers.json');\r\n      if (!fs.existsSync(customersPath)) {\r\n        return Response.json({ data: [] });\r\n      }\r\n\r\n      const customers = JSON.parse(fs.readFileSync(customersPath, 'utf-8') || '[]');\r\n      const lowerTerm = term.toLowerCase();\r\n\r\n      const results = customers.filter((c) =>\r\n        c.first_name?.toLowerCase().includes(lowerTerm) ||\r\n        c.last_name?.toLowerCase().includes(lowerTerm) ||\r\n        c.email?.toLowerCase().includes(lowerTerm) ||\r\n        c.phone?.includes(term)\r\n      );\r\n\r\n      return Response.json({ data: results.slice(0, 10) });\r\n    }\r\n\r\n    return Response.json({ error: 'Invalid action' }, { status: 400 });\r\n  } catch (error) {\r\n    console.error('Customer error:', error);\r\n    return Response.json({ error: 'Failed to fetch customers' }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function POST(request) {\r\n  try {\r\n    ensureDir();\r\n    const searchParams = new URL(request.url).searchParams;\r\n    const action = searchParams.get('action');\r\n\r\n    if (action === 'create') {\r\n      const body = await request.json();\r\n      const customersPath = getFilePath('customers.json');\r\n\r\n      let customers = [];\r\n      if (fs.existsSync(customersPath)) {\r\n        customers = JSON.parse(fs.readFileSync(customersPath, 'utf-8') || '[]');\r\n      }\r\n\r\n      const customerId = customers.length > 0 ? Math.max(...customers.map((c) => c.id || 0)) + 1 : 1;\r\n\r\n      const newCustomer = {\r\n        id: customerId,\r\n        first_name: body.first_name || '',\r\n        last_name: body.last_name || '',\r\n        email: body.email || '',\r\n        phone: body.phone || '',\r\n        address: body.address || '',\r\n        created_at: new Date().toISOString(),\r\n      };\r\n\r\n      customers.push(newCustomer);\r\n      fs.writeFileSync(customersPath, JSON.stringify(customers, null, 2));\r\n\r\n      return Response.json({ success: true, ...newCustomer });\r\n    }\r\n\r\n    return Response.json({ error: 'Invalid action' }, { status: 400 });\r\n  } catch (error) {\r\n    console.error('Customer create error:', error);\r\n    return Response.json({ error: 'Failed to create customer' }, { status: 500 });\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}}]
}