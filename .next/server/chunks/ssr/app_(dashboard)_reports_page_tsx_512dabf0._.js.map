{"version":3,"sources":["../../../../app/%28dashboard%29/reports/page.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport { useState, useEffect } from \"react\"\r\nimport { storage, type Booking } from \"@/lib/storage\"\r\n\r\nexport default function ReportsPage() {\r\n  const [bookings, setBookings] = useState<Booking[]>([])\r\n  const [dateRange, setDateRange] = useState({\r\n    start: new Date(Date.now() - 30 * 24 * 60 * 60 * 1000).toISOString().split(\"T\")[0],\r\n    end: new Date().toISOString().split(\"T\")[0],\r\n  })\r\n\r\n  useEffect(() => {\r\n    setBookings(storage.getBookings())\r\n  }, [])\r\n\r\n  const getFilteredBookings = () => {\r\n    return bookings.filter((b) => {\r\n      const date = b.dateFrom\r\n      return date >= dateRange.start && date <= dateRange.end && b.status !== \"cancelled\"\r\n    })\r\n  }\r\n\r\n  const calculateStats = () => {\r\n    const filtered = getFilteredBookings()\r\n    const totalBookings = filtered.length\r\n    const totalRevenue = filtered.filter((b) => b.paymentStatus === \"paid\").reduce((sum, b) => sum + b.totalAmount, 0)\r\n    const avgBookingValue = totalBookings > 0 ? totalRevenue / totalBookings : 0\r\n\r\n    return { totalBookings, totalRevenue, avgBookingValue }\r\n  }\r\n\r\n  const getDailySalesData = () => {\r\n    const filtered = getFilteredBookings()\r\n    const dailyData: { [key: string]: number } = {}\r\n\r\n    filtered.forEach((b) => {\r\n      if (!dailyData[b.dateFrom]) {\r\n        dailyData[b.dateFrom] = 0\r\n      }\r\n      dailyData[b.dateFrom] += b.totalAmount\r\n    })\r\n\r\n    return Object.entries(dailyData)\r\n      .sort(([dateA], [dateB]) => dateA.localeCompare(dateB))\r\n      .slice(-7)\r\n  }\r\n\r\n  const getAccommodationBreakdown = () => {\r\n    const filtered = getFilteredBookings()\r\n    const breakdown: { [key: string]: { count: number; revenue: number } } = {}\r\n\r\n    filtered.forEach((b) => {\r\n      const acc = storage.getAccommodations().find((a) => a.id === b.accommodationId)\r\n      if (acc) {\r\n        if (!breakdown[acc.name]) {\r\n          breakdown[acc.name] = { count: 0, revenue: 0 }\r\n        }\r\n        breakdown[acc.name].count++\r\n        breakdown[acc.name].revenue += b.totalAmount\r\n      }\r\n    })\r\n\r\n    return breakdown\r\n  }\r\n\r\n  const stats = calculateStats()\r\n  const dailySales = getDailySalesData()\r\n  const accommodationBreakdown = getAccommodationBreakdown()\r\n\r\n  const handleExportCSV = () => {\r\n    const filtered = getFilteredBookings()\r\n    const csv = [\r\n      [\"Date\", \"Client\", \"Accommodation\", \"Amount\", \"Status\"],\r\n      ...filtered.map((b) => {\r\n        const client = storage.getClients().find((c) => c.id === b.clientId)\r\n        const acc = storage.getAccommodations().find((a) => a.id === b.accommodationId)\r\n        return [b.dateFrom, `${client?.firstName} ${client?.lastName}`, acc?.name, b.totalAmount, b.status]\r\n      }),\r\n    ]\r\n      .map((row) => row.join(\",\"))\r\n      .join(\"\\n\")\r\n\r\n    const blob = new Blob([csv], { type: \"text/csv\" })\r\n    const url = window.URL.createObjectURL(blob)\r\n    const a = document.createElement(\"a\")\r\n    a.href = url\r\n    a.download = `report-${dateRange.start}.csv`\r\n    a.click()\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <h1 className=\"text-3xl font-bold text-(--primary-blue)\">Reports</h1>\r\n\r\n      {/* Date Range Filter */}\r\n      <div className=\"bg-white border border-(--gray-light) rounded p-4 flex gap-4 items-end\">\r\n        <div>\r\n          <label className=\"block text-sm font-bold text-(--gray-dark) mb-1\">From</label>\r\n          <input\r\n            type=\"date\"\r\n            value={dateRange.start}\r\n            onChange={(e) => setDateRange({ ...dateRange, start: e.target.value })}\r\n            className=\"px-3 py-2 border border-(--gray-light) rounded\"\r\n          />\r\n        </div>\r\n        <div>\r\n          <label className=\"block text-sm font-bold text-(--gray-dark) mb-1\">To</label>\r\n          <input\r\n            type=\"date\"\r\n            value={dateRange.end}\r\n            onChange={(e) => setDateRange({ ...dateRange, end: e.target.value })}\r\n            className=\"px-3 py-2 border border-(--gray-light) rounded\"\r\n          />\r\n        </div>\r\n        <button\r\n          onClick={handleExportCSV}\r\n          className=\"px-4 py-2 bg-(--yellow) text-(--gray-dark) rounded font-bold hover:bg-yellow-400\"\r\n        >\r\n          Export CSV\r\n        </button>\r\n      </div>\r\n\r\n      {/* Key Metrics */}\r\n      <div className=\"grid grid-cols-3 gap-4\">\r\n        <div className=\"bg-white border border-(--gray-light) rounded p-6\">\r\n          <p className=\"text-sm text-(--gray-dark) mb-1\">Total Bookings</p>\r\n          <p className=\"text-3xl font-bold text-(--primary-blue)\">{stats.totalBookings}</p>\r\n        </div>\r\n        <div className=\"bg-white border border-(--gray-light) rounded p-6\">\r\n          <p className=\"text-sm text-(--gray-dark) mb-1\">Total Revenue</p>\r\n          <p className=\"text-3xl font-bold text-(--primary-blue)\">₱{stats.totalRevenue.toLocaleString()}</p>\r\n        </div>\r\n        <div className=\"bg-white border border-(--gray-light) rounded p-6\">\r\n          <p className=\"text-sm text-(--gray-dark) mb-1\">Avg. Booking Value</p>\r\n          <p className=\"text-3xl font-bold text-(--primary-blue)\">\r\n            ₱{Math.round(stats.avgBookingValue).toLocaleString()}\r\n          </p>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Daily Sales */}\r\n      <div className=\"bg-white border border-(--gray-light) rounded p-6\">\r\n        <h2 className=\"text-lg font-bold text-(--gray-dark) mb-4\">Last 7 Days Sales</h2>\r\n        <div className=\"space-y-2\">\r\n          {dailySales.map(([date, amount]) => (\r\n            <div key={date} className=\"flex items-center gap-4\">\r\n              <span className=\"w-24 text-sm font-bold\">{date}</span>\r\n              <div className=\"flex-1 bg-(--gray-bg) rounded h-8 relative overflow-hidden\">\r\n                <div\r\n                  className=\"bg-(--yellow) h-full transition-all\"\r\n                  style={{\r\n                    width: `${Math.min(100, (amount / Math.max(...dailySales.map((d) => d[1]))) * 100)}%`,\r\n                  }}\r\n                />\r\n              </div>\r\n              <span className=\"w-32 text-right font-bold\">₱{amount.toLocaleString()}</span>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Accommodation Breakdown */}\r\n      <div className=\"bg-white border border-(--gray-light) rounded p-6\">\r\n        <h2 className=\"text-lg font-bold text-(--gray-dark) mb-4\">Accommodation Performance</h2>\r\n        <div className=\"overflow-x-auto\">\r\n          <table className=\"w-full\">\r\n            <thead className=\"bg-(--gray-bg) border-b border-(--gray-light)\">\r\n              <tr>\r\n                <th className=\"text-left py-2 px-4 font-bold\">Accommodation</th>\r\n                <th className=\"text-left py-2 px-4 font-bold\">Bookings</th>\r\n                <th className=\"text-left py-2 px-4 font-bold\">Revenue</th>\r\n                <th className=\"text-left py-2 px-4 font-bold\">Avg/Booking</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              {Object.entries(accommodationBreakdown).map(([name, data]) => (\r\n                <tr key={name} className=\"border-b border-(--gray-light)\">\r\n                  <td className=\"py-3 px-4\">{name}</td>\r\n                  <td className=\"py-3 px-4 font-bold\">{data.count}</td>\r\n                  <td className=\"py-3 px-4 font-bold\">₱{data.revenue.toLocaleString()}</td>\r\n                  <td className=\"py-3 px-4\">₱{Math.round(data.revenue / data.count).toLocaleString()}</td>\r\n                </tr>\r\n              ))}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n"],"names":[],"mappings":"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"}